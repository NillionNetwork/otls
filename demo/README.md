# C++ to Rust gRPC Demo for PVSS

This is a demonstration of connecting C++ and Rust components using gRPC, specifically for a Publicly Verifiable Secret Sharing (PVSS) system.

## Project Structure

```
demo/
├── proto/       # Protocol buffer definitions
├── cpp/         # C++ client implementation
├── rust/        # Rust server implementation
└── README.md    # This file
```

## Prerequisites

### For C++
- CMake (3.10 or newer)
- A C++ compiler with C++14 support
- gRPC and Protocol Buffers for C++

### For Rust
- Rust and Cargo (install via [rustup](https://rustup.rs/))
- Protocol Buffers compiler

## Installation

### Installing gRPC and Protocol Buffers

Due to potential version mismatches between system Protocol Buffers and gRPC, it's recommended to install both from source:

```bash
# Install dependencies
sudo apt-get update
sudo apt-get install -y build-essential autoconf libtool pkg-config cmake
sudo apt-get install -y libssl-dev

# Clone the gRPC repository
git clone --recurse-submodules -b v1.45.0 https://github.com/grpc/grpc
cd grpc

# Build and install gRPC
mkdir -p cmake/build
cd cmake/build
cmake -DgRPC_INSTALL=ON \
      -DgRPC_BUILD_TESTS=OFF \
      -DCMAKE_INSTALL_PREFIX=/usr/local \
      ../..
make -j4
sudo make install

# Update the linker cache
sudo ldconfig
```

### Installing Rust Components

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source $HOME/.cargo/env
sudo apt install -y protobuf-compiler
```

## Building and Running

### 1. Build and Run the Rust Server

```bash
cd rust
cargo build
cargo run
```

The server will start and listen on `localhost:50051`.

### 2. Build and Run the C++ Client

In a separate terminal:

```bash
cd cpp
mkdir -p build
cd build
# Use explicit paths to ensure the correct gRPC version is used
cmake .. -DCMAKE_PREFIX_PATH=/usr/local
make
./pvss_client
```

If you encounter Protocol Buffer version mismatch errors like:
```
#error This file was generated by an older version of protoc which is
#error incompatible with your Protocol Buffer headers.
```

Try the following:
1. Clear your build directory:
   ```bash
   rm -rf *
   ```
2. Run CMake with explicit protoc path:
   ```bash
   cmake .. -DCMAKE_PREFIX_PATH=/usr/local -DProtobuf_PROTOC_EXECUTABLE=/usr/local/bin/protoc
   ```
3. Build again:
   ```bash
   make
   ```

## Troubleshooting

### Protocol Buffer Version Mismatch

If you see errors about Protocol Buffer version mismatches:

1. Ensure you've installed gRPC and Protocol Buffers from source using the instructions above.
2. Verify that CMake is finding the correct versions:
   ```bash
   which protoc
   protoc --version
   ```
3. If your system has multiple protoc versions, explicitly set the path:
   ```bash
   cmake .. -DProtobuf_PROTOC_EXECUTABLE=/usr/local/bin/protoc
   ```

### Missing gRPC Config

If CMake fails with:
```
Could not find a package configuration file provided by "gRPC"
```

Ensure that:
1. gRPC was installed correctly to `/usr/local`
2. Set the prefix path explicitly:
   ```bash
   cmake .. -DCMAKE_PREFIX_PATH=/usr/local
   ```

## How It Works

1. The protocol is defined in `proto/pvss.proto`
2. The Rust server implements the gRPC service defined in the proto file
3. The C++ client generates mock cryptographic data (shares, committed shares, and signatures)
4. The client sends this data to the server via gRPC
5. The server processes the data and returns a response
6. The client handles the response

## Integration with Real Cryptographic Code

To integrate with your actual cryptographic code:

1. In the C++ client, replace the mock functions with your actual cryptographic implementations
2. In the Rust server, replace the mock PVSS processing with your actual PVSS implementation
3. Ensure that the data serialization/deserialization is compatible between both sides

## Extending the API

To extend the API:

1. Modify the protocol buffer definitions in `proto/pvss.proto`
2. Rebuild both the C++ and Rust components
3. Implement the new functionality in both the client and server